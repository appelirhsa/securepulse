<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Dashboard - SecurePulse</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="styleSP.css">
  <style>
    .dashboard-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: calc(100vh - 80px);
      margin-top: 80px;
      background: #f5f5f5;
    }
    
    .dashboard-sidebar {
      background: white;
      border-right: 1px solid #ddd;
      padding: 20px;
      position: sticky;
      top: 80px;
      height: fit-content;
    }
    
    .dashboard-main {
      padding: 30px;
      overflow-y: auto;
    }
    
    .sidebar-item {
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #666;
      text-decoration: none;
      border-left: 3px solid transparent;
    }
    
    .sidebar-item:hover {
      background: #f0f0f0;
      color: #333;
    }
    
    .sidebar-item.active {
      background: #e8f4f8;
      color: #0066cc;
      border-left-color: #0066cc;
      font-weight: 600;
    }
    
    .dashboard-section {
      display: none;
    }
    
    .dashboard-section.active {
      display: block;
    }
    
    .health-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .health-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .health-value {
      font-size: 2.5em;
      font-weight: bold;
      color: #0066cc;
      margin: 10px 0;
    }
    
    .health-label {
      color: #666;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .health-status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.85em;
      margin-top: 10px;
      display: inline-block;
    }
    
    .health-status.normal {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .health-status.warning {
      background: #fff3e0;
      color: #e65100;
    }
    
    .health-status.alert {
      background: #ffebee;
      color: #c62828;
    }
    
    .bracelets-list {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .bracelet-item {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.3s ease;
    }
    
    .bracelet-item:last-child {
      border-bottom: none;
    }
    
    .bracelet-item:hover {
      background: #f9f9f9;
    }
    
    .bracelet-info h4 {
      margin: 0 0 5px 0;
      color: #333;
    }
    
    .bracelet-status {
      font-size: 0.9em;
      color: #666;
    }
    
    .bracelet-battery {
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .battery-level {
      width: 40px;
      height: 20px;
      border: 1px solid #ccc;
      border-radius: 3px;
      overflow: hidden;
      background: #f0f0f0;
    }
    
    .battery-fill {
      height: 100%;
      background: #4caf50;
      width: 100%;
      transition: width 0.3s ease;
    }
    
    .btn-small {
      padding: 8px 15px;
      font-size: 0.9em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-small.primary {
      background: #0066cc;
      color: white;
    }
    
    .btn-small.primary:hover {
      background: #0052a3;
    }
    
    .btn-small.secondary {
      background: #e0e0e0;
      color: #333;
    }
    
    .btn-small.secondary:hover {
      background: #d0d0d0;
    }
    
    .alerts-list {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .alert-item {
      padding: 20px;
      border-left: 4px solid #ff9800;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: start;
    }
    
    .alert-item.resolved {
      border-left-color: #4caf50;
      background: #f1f8f4;
    }
    
    .alert-content h4 {
      margin: 0 0 5px 0;
    }
    
    .alert-time {
      color: #666;
      font-size: 0.9em;
    }
    
    .alert-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
    }
    
    .alert-badge.active {
      background: #ffebee;
      color: #c62828;
    }
    
    .alert-badge.resolved {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    .auth-prompt {
      background: white;
      padding: 40px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .auth-prompt h2 {
      margin-bottom: 20px;
      color: #333;
    }
    
    .auth-prompt p {
      margin-bottom: 20px;
      color: #666;
    }
    
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1em;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #0066cc;
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
    }
    
    .logout-btn {
      background: #ff6b6b;
      color: white;
    }
    
    .logout-btn:hover {
      background: #ff5252;
    }

    @media (max-width: 768px) {
      .dashboard-container {
        grid-template-columns: 1fr;
      }
      
      .dashboard-sidebar {
        position: relative;
        top: 0;
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding: 10px;
        border-right: none;
        border-bottom: 1px solid #ddd;
      }
      
      .sidebar-item {
        white-space: nowrap;
        flex-shrink: 0;
      }
      
      .dashboard-main {
        padding: 20px;
      }
      
      .health-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

<header class="navbar">
  <div class="navbar-content container">
    <a href="index.html" class="logo">
      <div class="logo-icon">SP</div>
      <span>SecurePulse</span>
    </a>
    <nav id="mainNav">
      <a href="index.html">Home</a>
      <a href="index.html#product">Product</a>
      <a href="dashboard.html" class="active">Dashboard</a>
      <button class="login-btn" id="logoutBtn" style="background: #ff6b6b;">Logout</button>
    </nav>
    <button class="mobile-menu-btn" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</header>

<div class="dashboard-container">
  <aside class="dashboard-sidebar">
    <a class="sidebar-item active" onclick="showSection('overview')">
      <i class="fas fa-chart-line"></i> Overview
    </a>
    <a class="sidebar-item" onclick="showSection('bracelets')">
      <i class="fas fa-watch"></i> My Bracelets
    </a>
    <a class="sidebar-item" onclick="showSection('health')">
      <i class="fas fa-heartbeat"></i> Health Data
    </a>
    <a class="sidebar-item" onclick="showSection('alerts')">
      <i class="fas fa-bell"></i> Alerts
    </a>
    <a class="sidebar-item" onclick="showSection('profile')">
      <i class="fas fa-user"></i> Profile
    </a>
    <a class="sidebar-item logout-btn" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> Logout
    </a>
  </aside>

  <main class="dashboard-main">
    <!-- OVERVIEW SECTION -->
    <section class="dashboard-section active" id="overview">
      <h1>Dashboard</h1>
      <p style="color: #666; margin-bottom: 30px;">Welcome back! Here's your safety overview.</p>
      
      <div class="health-grid">
        <div class="health-card">
          <i class="fas fa-heart" style="font-size: 2em; color: #0066cc;"></i>
          <div class="health-label">Heart Rate</div>
          <div class="health-value" id="heartRate">--</div>
          <div class="health-status normal">Normal</div>
        </div>
        <div class="health-card">
          <i class="fas fa-lungs" style="font-size: 2em; color: #0066cc;"></i>
          <div class="health-label">Blood Oxygen</div>
          <div class="health-value" id="bloodOxygen">--</div>
          <div class="health-status normal">Normal</div>
        </div>
        <div class="health-card">
          <i class="fas fa-thermometer" style="font-size: 2em; color: #0066cc;"></i>
          <div class="health-label">Temperature</div>
          <div class="health-value" id="temperature">--</div>
          <div class="health-status normal">Normal</div>
        </div>
        <div class="health-card">
          <i class="fas fa-check-circle" style="font-size: 2em; color: #0066cc;"></i>
          <div class="health-label">Bracelet Status</div>
          <div class="health-value" style="font-size: 1.5em;" id="braceletStatus">--</div>
          <div class="health-status normal">Connected</div>
        </div>
      </div>
    </section>

    <!-- BRACELETS SECTION -->
    <section class="dashboard-section" id="bracelets">
      <h1>My Bracelets</h1>
      <p style="color: #666; margin-bottom: 20px;">Manage and monitor your connected devices.</p>
      
      <button class="btn primary" onclick="showSection('addBracelet')" style="margin-bottom: 20px;">
        <i class="fas fa-plus"></i> Add New Bracelet
      </button>
      
      <div class="bracelets-list" id="braceletsList">
        <p style="padding: 20px; text-align: center; color: #999;">Loading bracelets...</p>
      </div>
    </section>

    <!-- HEALTH DATA SECTION -->
    <section class="dashboard-section" id="health">
      <h1>Health Data</h1>
      <p style="color: #666; margin-bottom: 20px;">Your health metrics over time.</p>
      
      <div class="health-grid">
        <div class="health-card">
          <div class="health-label">Average Heart Rate</div>
          <div class="health-value" id="avgHeartRate">--</div>
          <div class="health-status normal">Last 24h</div>
        </div>
        <div class="health-card">
          <div class="health-label">Lowest O2</div>
          <div class="health-value" id="minOxygen">--</div>
          <div class="health-status normal">Last 24h</div>
        </div>
        <div class="health-card">
          <div class="health-label">Highest Temp</div>
          <div class="health-value" id="maxTemp">--</div>
          <div class="health-status normal">Last 24h</div>
        </div>
      </div>
    </section>

    <!-- ALERTS SECTION -->
    <section class="dashboard-section" id="alerts">
      <h1>Emergency Alerts</h1>
      <p style="color: #666; margin-bottom: 20px;">Your alert history and status.</p>
      
      <div class="alerts-list" id="alertsList">
        <p style="padding: 20px; text-align: center; color: #999;">Loading alerts...</p>
      </div>
    </section>

    <!-- PROFILE SECTION -->
    <section class="dashboard-section" id="profile">
      <h1>Profile Settings</h1>
      <p style="color: #666; margin-bottom: 20px;">Manage your account information.</p>
      
      <div style="max-width: 500px;">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="profileName" placeholder="Your name">
        </div>
        
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="profileEmail" placeholder="Your email" readonly>
        </div>
        
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" id="profilePhone" placeholder="Your phone number">
        </div>
        
        <div class="form-group">
          <label>Plan</label>
          <select id="profilePlan">
            <option value="individual">Individual Plan - R49/month</option>
            <option value="family">Family Plan - R199/month</option>
            <option value="organization">Organization Plan - R499/month</option>
          </select>
        </div>
        
        <button class="btn primary" onclick="updateProfile()">Save Changes</button>
      </div>

      <hr style="margin: 40px 0; border: none; border-top: 1px solid #ddd;">
      
      <h3>Emergency Contacts</h3>
      <p style="color: #666; margin-bottom: 20px;">Add people to be notified in case of emergency.</p>
      
      <div style="max-width: 500px; margin-bottom: 20px;">
        <div class="form-group">
          <label>Contact Name</label>
          <input type="text" id="contactName" placeholder="Name">
        </div>
        
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" id="contactPhone" placeholder="Phone number">
        </div>
        
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="contactEmail" placeholder="Email address">
        </div>
        
        <button class="btn primary" onclick="addEmergencyContact()">Add Contact</button>
      </div>
      
      <div id="emergencyContacts"></div>
    </section>
  </main>
</div>

<script src="api.js"></script>
<script>
  const api = new SecurePulseAPI();
  let currentUser = null;

  // Initialize dashboard
  async function initDashboard() {
    const token = localStorage.getItem('authToken');
    if (!token) {
      window.location.href = 'index.html';
      return;
    }

    try {
      currentUser = await api.getProfile();
      loadDashboardData();
    } catch (error) {
      console.error('Failed to load profile:', error);
      logout();
    }
  }

  // Load all dashboard data
  async function loadDashboardData() {
    try {
      // Simulate loading health data
      document.getElementById('heartRate').textContent = Math.floor(Math.random() * 40) + 60 + ' bpm';
      document.getElementById('bloodOxygen').textContent = Math.floor(Math.random() * 5) + 95 + '%';
      document.getElementById('temperature').textContent = (36.5 + Math.random()).toFixed(1) + 'Â°C';
      document.getElementById('braceletStatus').textContent = '1';

      // Load bracelets
      const bracelets = await api.listBracelets();
      displayBracelets(bracelets);

      // Load alerts
      const alerts = await api.listAlerts();
      displayAlerts(alerts);

      // Populate profile
      document.getElementById('profileName').value = currentUser.name || '';
      document.getElementById('profileEmail').value = currentUser.email || '';
      document.getElementById('profilePhone').value = currentUser.phone || '';
      document.getElementById('profilePlan').value = currentUser.plan || 'individual';
    } catch (error) {
      console.error('Error loading dashboard data:', error);
    }
  }

  // Display bracelets
  function displayBracelets(bracelets) {
    const list = document.getElementById('braceletsList');
    if (bracelets.length === 0) {
      list.innerHTML = '<p style="padding: 20px; text-align: center; color: #999;">No bracelets connected yet. Add one to get started!</p>';
      return;
    }

    list.innerHTML = bracelets.map(b => `
      <div class="bracelet-item">
        <div class="bracelet-info">
          <h4><i class="fas fa-watch"></i> ${b.nickname}</h4>
          <div class="bracelet-status">Device ID: ${b.deviceId}</div>
          <div class="bracelet-battery">
            <span>Battery:</span>
            <div class="battery-level">
              <div class="battery-fill" style="width: ${b.batteryLevel || 80}%"></div>
            </div>
            <span>${b.batteryLevel || 80}%</span>
          </div>
        </div>
        <button class="btn-small primary">View Details</button>
      </div>
    `).join('');
  }

  // Display alerts
  function displayAlerts(alerts) {
    const list = document.getElementById('alertsList');
    if (alerts.length === 0) {
      list.innerHTML = '<p style="padding: 20px; text-align: center; color: #999;">No alerts. Stay safe!</p>';
      return;
    }

    list.innerHTML = alerts.map(a => `
      <div class="alert-item ${a.status === 'resolved' ? 'resolved' : ''}">
        <div class="alert-content">
          <h4><i class="fas fa-exclamation-circle"></i> ${a.type.toUpperCase()}</h4>
          <div class="alert-time">${new Date(a.createdAt).toLocaleDateString()} at ${new Date(a.createdAt).toLocaleTimeString()}</div>
        </div>
        <span class="alert-badge ${a.status === 'active' ? 'active' : 'resolved'}">${a.status.toUpperCase()}</span>
      </div>
    `).join('');
  }

  // Show section
  function showSection(sectionId) {
    document.querySelectorAll('.dashboard-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.sidebar-item').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    event?.target?.closest('.sidebar-item')?.classList.add('active');
  }

  // Update profile
  async function updateProfile() {
    try {
      await api.updateProfile(
        document.getElementById('profileName').value,
        document.getElementById('profilePhone').value,
        document.getElementById('profilePlan').value
      );
      alert('Profile updated successfully!');
    } catch (error) {
      alert('Failed to update profile');
    }
  }

  // Add emergency contact
  async function addEmergencyContact() {
    try {
      await api.addEmergencyContact(
        document.getElementById('contactName').value,
        document.getElementById('contactPhone').value,
        document.getElementById('contactEmail').value
      );
      alert('Emergency contact added!');
      document.getElementById('contactName').value = '';
      document.getElementById('contactPhone').value = '';
      document.getElementById('contactEmail').value = '';
    } catch (error) {
      alert('Failed to add emergency contact');
    }
  }

  // Logout
  function logout() {
    api.logout();
    localStorage.removeItem('authToken');
    window.location.href = 'index.html';
  }

  // Initialize on load
  initDashboard();
</script>

</body>
</html>
